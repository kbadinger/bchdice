{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"/Users/kevinbadinger/eos/reactdemo/WCWReact/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\");\n\nvar _asyncToGenerator = require(\"/Users/kevinbadinger/eos/reactdemo/WCWReact/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/asyncToGenerator\");\n\nvar _classCallCheck = require(\"/Users/kevinbadinger/eos/reactdemo/WCWReact/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/Users/kevinbadinger/eos/reactdemo/WCWReact/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar Rpc_1 = __importDefault(require(\"../../Actions/Rpc\"));\n\nvar RpcError_1 = __importDefault(require(\"../../Errors/RpcError\"));\n\nvar Asset_1 = __importDefault(require(\"./Asset\"));\n\nvar Cache_1 = __importDefault(require(\"./Cache\"));\n\nvar Collection_1 = __importDefault(require(\"./Collection\"));\n\nvar Offer_1 = __importDefault(require(\"./Offer\"));\n\nvar Queue_1 = __importDefault(require(\"./Queue\"));\n\nvar Schema_1 = __importDefault(require(\"./Schema\"));\n\nvar Template_1 = __importDefault(require(\"./Template\"));\n\nvar RpcApi = /*#__PURE__*/function () {\n  function RpcApi(endpoint, contract) {\n    var _this = this;\n\n    var args = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {\n      rateLimit: 4\n    };\n\n    _classCallCheck(this, RpcApi);\n\n    this.endpoint = endpoint;\n    this.contract = contract;\n\n    if (args.fetch) {\n      this.fetchBuiltin = args.fetch;\n    } else {\n      this.fetchBuiltin = global.fetch;\n    }\n\n    this.queue = new Queue_1.default(this, args.rateLimit);\n    this.cache = new Cache_1.default();\n    this.action = new Rpc_1.default(this);\n    this._config = new Promise( /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(resolve, reject) {\n        var resp;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                _context.next = 3;\n                return _this.getTableRows({\n                  code: _this.contract,\n                  scope: _this.contract,\n                  table: 'config'\n                });\n\n              case 3:\n                resp = _context.sent;\n\n                if (!(resp.rows.length !== 1)) {\n                  _context.next = 6;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", reject('invalid config'));\n\n              case 6:\n                return _context.abrupt(\"return\", resolve(resp.rows[0]));\n\n              case 9:\n                _context.prev = 9;\n                _context.t0 = _context[\"catch\"](0);\n                reject(_context.t0);\n\n              case 12:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[0, 9]]);\n      }));\n\n      return function (_x, _x2) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n  }\n\n  _createClass(RpcApi, [{\n    key: \"config\",\n    value: function () {\n      var _config = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return this._config;\n\n              case 2:\n                return _context2.abrupt(\"return\", _context2.sent);\n\n              case 3:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function config() {\n        return _config.apply(this, arguments);\n      }\n\n      return config;\n    }()\n  }, {\n    key: \"getAsset\",\n    value: function () {\n      var _getAsset = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(owner, id) {\n        var cache,\n            data,\n            _args3 = arguments;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                cache = _args3.length > 2 && _args3[2] !== undefined ? _args3[2] : true;\n\n                if (!cache) {\n                  this.cache.deleteAsset(id);\n                }\n\n                _context3.next = 4;\n                return this.queue.fetchAsset(owner, id, cache);\n\n              case 4:\n                data = _context3.sent;\n                return _context3.abrupt(\"return\", new Asset_1.default(this, owner, id, data, undefined, undefined, undefined, cache));\n\n              case 6:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function getAsset(_x3, _x4) {\n        return _getAsset.apply(this, arguments);\n      }\n\n      return getAsset;\n    }()\n  }, {\n    key: \"getTemplate\",\n    value: function () {\n      var _getTemplate = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(collectionName, templateID) {\n        var cache,\n            data,\n            _args4 = arguments;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                cache = _args4.length > 2 && _args4[2] !== undefined ? _args4[2] : true;\n\n                if (!cache) {\n                  this.cache.deleteTemplate(collectionName, templateID);\n                }\n\n                _context4.next = 4;\n                return this.queue.fetchTemplate(collectionName, templateID, cache);\n\n              case 4:\n                data = _context4.sent;\n                return _context4.abrupt(\"return\", new Template_1.default(this, collectionName, templateID, data, undefined, cache));\n\n              case 6:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function getTemplate(_x5, _x6) {\n        return _getTemplate.apply(this, arguments);\n      }\n\n      return getTemplate;\n    }()\n  }, {\n    key: \"getCollection\",\n    value: function () {\n      var _getCollection = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(collectionName) {\n        var cache,\n            data,\n            _args5 = arguments;\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                cache = _args5.length > 1 && _args5[1] !== undefined ? _args5[1] : true;\n\n                if (!cache) {\n                  this.cache.deleteCollection(collectionName);\n                }\n\n                _context5.next = 4;\n                return this.queue.fetchCollection(collectionName, cache);\n\n              case 4:\n                data = _context5.sent;\n                return _context5.abrupt(\"return\", new Collection_1.default(this, collectionName, data, cache));\n\n              case 6:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function getCollection(_x7) {\n        return _getCollection.apply(this, arguments);\n      }\n\n      return getCollection;\n    }()\n  }, {\n    key: \"getCollectionTemplates\",\n    value: function () {\n      var _getCollectionTemplates = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6(collectionName) {\n        var _this2 = this;\n\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                _context6.next = 2;\n                return this.queue.fetchCollectionTemplates(collectionName);\n\n              case 2:\n                return _context6.abrupt(\"return\", _context6.sent.map(function (templateRow) {\n                  return new Template_1.default(_this2, collectionName, String(templateRow.template_id), templateRow, undefined);\n                }));\n\n              case 3:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n\n      function getCollectionTemplates(_x8) {\n        return _getCollectionTemplates.apply(this, arguments);\n      }\n\n      return getCollectionTemplates;\n    }()\n  }, {\n    key: \"getCollectionsSchemas\",\n    value: function () {\n      var _getCollectionsSchemas = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7(collectionName) {\n        var _this3 = this;\n\n        return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                _context7.next = 2;\n                return this.queue.fetchCollectionSchemas(collectionName);\n\n              case 2:\n                return _context7.abrupt(\"return\", _context7.sent.map(function (schemaRow) {\n                  return new Schema_1.default(_this3, collectionName, schemaRow.schema_name, undefined);\n                }));\n\n              case 3:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n\n      function getCollectionsSchemas(_x9) {\n        return _getCollectionsSchemas.apply(this, arguments);\n      }\n\n      return getCollectionsSchemas;\n    }()\n  }, {\n    key: \"getSchema\",\n    value: function () {\n      var _getSchema = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee8(collectionName, schemaName) {\n        var cache,\n            data,\n            _args8 = arguments;\n        return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                cache = _args8.length > 2 && _args8[2] !== undefined ? _args8[2] : true;\n\n                if (!cache) {\n                  this.cache.deleteSchema(collectionName, schemaName);\n                }\n\n                _context8.next = 4;\n                return this.queue.fetchSchema(collectionName, schemaName, cache);\n\n              case 4:\n                data = _context8.sent;\n                return _context8.abrupt(\"return\", new Schema_1.default(this, collectionName, schemaName, data, cache));\n\n              case 6:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee8, this);\n      }));\n\n      function getSchema(_x10, _x11) {\n        return _getSchema.apply(this, arguments);\n      }\n\n      return getSchema;\n    }()\n  }, {\n    key: \"getOffer\",\n    value: function () {\n      var _getOffer = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee9(offerID) {\n        var cache,\n            data,\n            _args9 = arguments;\n        return _regeneratorRuntime.wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                cache = _args9.length > 1 && _args9[1] !== undefined ? _args9[1] : true;\n\n                if (!cache) {\n                  this.cache.deleteOffer(offerID);\n                }\n\n                _context9.next = 4;\n                return this.queue.fetchOffer(offerID, cache);\n\n              case 4:\n                data = _context9.sent;\n                return _context9.abrupt(\"return\", new Offer_1.default(this, offerID, data, undefined, undefined, cache));\n\n              case 6:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9, this);\n      }));\n\n      function getOffer(_x12) {\n        return _getOffer.apply(this, arguments);\n      }\n\n      return getOffer;\n    }()\n  }, {\n    key: \"getAccountOffers\",\n    value: function () {\n      var _getAccountOffers = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee10(account) {\n        var _this4 = this;\n\n        return _regeneratorRuntime.wrap(function _callee10$(_context10) {\n          while (1) {\n            switch (_context10.prev = _context10.next) {\n              case 0:\n                _context10.next = 2;\n                return this.queue.fetchAccountOffers(account);\n\n              case 2:\n                return _context10.abrupt(\"return\", _context10.sent.map(function (offerRow) {\n                  return new Offer_1.default(_this4, offerRow.offer_id, offerRow, undefined, undefined);\n                }));\n\n              case 3:\n              case \"end\":\n                return _context10.stop();\n            }\n          }\n        }, _callee10, this);\n      }));\n\n      function getAccountOffers(_x13) {\n        return _getAccountOffers.apply(this, arguments);\n      }\n\n      return getAccountOffers;\n    }()\n  }, {\n    key: \"getAccountAssets\",\n    value: function () {\n      var _getAccountAssets = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee11(account) {\n        var _this5 = this;\n\n        return _regeneratorRuntime.wrap(function _callee11$(_context11) {\n          while (1) {\n            switch (_context11.prev = _context11.next) {\n              case 0:\n                _context11.next = 2;\n                return this.queue.fetchAccountAssets(account);\n\n              case 2:\n                return _context11.abrupt(\"return\", _context11.sent.map(function (assetRow) {\n                  return new Asset_1.default(_this5, account, assetRow.asset_id, assetRow, undefined, undefined, undefined);\n                }));\n\n              case 3:\n              case \"end\":\n                return _context11.stop();\n            }\n          }\n        }, _callee11, this);\n      }));\n\n      function getAccountAssets(_x14) {\n        return _getAccountAssets.apply(this, arguments);\n      }\n\n      return getAccountAssets;\n    }()\n  }, {\n    key: \"getCollectionInventory\",\n    value: function () {\n      var _getCollectionInventory = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee12(collectionName, account) {\n        var _this6 = this;\n\n        return _regeneratorRuntime.wrap(function _callee12$(_context12) {\n          while (1) {\n            switch (_context12.prev = _context12.next) {\n              case 0:\n                _context12.next = 2;\n                return this.queue.preloadCollection(collectionName, true);\n\n              case 2:\n                _context12.next = 4;\n                return this.queue.fetchAccountAssets(account);\n\n              case 4:\n                return _context12.abrupt(\"return\", _context12.sent.filter(function (assetRow) {\n                  return assetRow.collection_name === collectionName;\n                }).map(function (assetRow) {\n                  return new Asset_1.default(_this6, account, assetRow.asset_id, assetRow, undefined, undefined, undefined);\n                }));\n\n              case 5:\n              case \"end\":\n                return _context12.stop();\n            }\n          }\n        }, _callee12, this);\n      }));\n\n      function getCollectionInventory(_x15, _x16) {\n        return _getCollectionInventory.apply(this, arguments);\n      }\n\n      return getCollectionInventory;\n    }()\n  }, {\n    key: \"preloadCollection\",\n    value: function () {\n      var _preloadCollection = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee13(collectionName) {\n        var cache,\n            _args13 = arguments;\n        return _regeneratorRuntime.wrap(function _callee13$(_context13) {\n          while (1) {\n            switch (_context13.prev = _context13.next) {\n              case 0:\n                cache = _args13.length > 1 && _args13[1] !== undefined ? _args13[1] : true;\n                _context13.next = 3;\n                return this.queue.preloadCollection(collectionName, cache);\n\n              case 3:\n              case \"end\":\n                return _context13.stop();\n            }\n          }\n        }, _callee13, this);\n      }));\n\n      function preloadCollection(_x17) {\n        return _preloadCollection.apply(this, arguments);\n      }\n\n      return preloadCollection;\n    }()\n  }, {\n    key: \"getTableRows\",\n    value: function () {\n      var _getTableRows = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee14(_ref2) {\n        var code, scope, table, _ref2$table_key, table_key, _ref2$lower_bound, lower_bound, _ref2$upper_bound, upper_bound, _ref2$index_position, index_position, _ref2$key_type, key_type;\n\n        return _regeneratorRuntime.wrap(function _callee14$(_context14) {\n          while (1) {\n            switch (_context14.prev = _context14.next) {\n              case 0:\n                code = _ref2.code, scope = _ref2.scope, table = _ref2.table, _ref2$table_key = _ref2.table_key, table_key = _ref2$table_key === void 0 ? '' : _ref2$table_key, _ref2$lower_bound = _ref2.lower_bound, lower_bound = _ref2$lower_bound === void 0 ? '' : _ref2$lower_bound, _ref2$upper_bound = _ref2.upper_bound, upper_bound = _ref2$upper_bound === void 0 ? '' : _ref2$upper_bound, _ref2$index_position = _ref2.index_position, index_position = _ref2$index_position === void 0 ? 1 : _ref2$index_position, _ref2$key_type = _ref2.key_type, key_type = _ref2$key_type === void 0 ? '' : _ref2$key_type;\n                _context14.next = 3;\n                return this.fetchRpc('/v1/chain/get_table_rows', {\n                  code: code,\n                  scope: scope,\n                  table: table,\n                  table_key: table_key,\n                  lower_bound: lower_bound,\n                  upper_bound: upper_bound,\n                  index_position: index_position,\n                  key_type: key_type,\n                  limit: 101,\n                  reverse: false,\n                  show_payer: false,\n                  json: true\n                });\n\n              case 3:\n                return _context14.abrupt(\"return\", _context14.sent);\n\n              case 4:\n              case \"end\":\n                return _context14.stop();\n            }\n          }\n        }, _callee14, this);\n      }));\n\n      function getTableRows(_x18) {\n        return _getTableRows.apply(this, arguments);\n      }\n\n      return getTableRows;\n    }()\n  }, {\n    key: \"fetchRpc\",\n    value: function () {\n      var _fetchRpc = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee15(path, body) {\n        var response, json, f;\n        return _regeneratorRuntime.wrap(function _callee15$(_context15) {\n          while (1) {\n            switch (_context15.prev = _context15.next) {\n              case 0:\n                _context15.prev = 0;\n                f = this.fetchBuiltin;\n                _context15.next = 4;\n                return f(this.endpoint + path, {\n                  body: JSON.stringify(body),\n                  method: 'POST'\n                });\n\n              case 4:\n                response = _context15.sent;\n                _context15.next = 7;\n                return response.json();\n\n              case 7:\n                json = _context15.sent;\n                _context15.next = 14;\n                break;\n\n              case 10:\n                _context15.prev = 10;\n                _context15.t0 = _context15[\"catch\"](0);\n                _context15.t0.isFetchError = true;\n                throw _context15.t0;\n\n              case 14:\n                if (!(json.processed && json.processed.except || !response.ok)) {\n                  _context15.next = 16;\n                  break;\n                }\n\n                throw new RpcError_1.default(json);\n\n              case 16:\n                return _context15.abrupt(\"return\", json);\n\n              case 17:\n              case \"end\":\n                return _context15.stop();\n            }\n          }\n        }, _callee15, this, [[0, 10]]);\n      }));\n\n      function fetchRpc(_x19, _x20) {\n        return _fetchRpc.apply(this, arguments);\n      }\n\n      return fetchRpc;\n    }()\n  }]);\n\n  return RpcApi;\n}();\n\nexports.default = RpcApi;","map":{"version":3,"sources":["/Users/kevinbadinger/eos/reactdemo/WCWReact/node_modules/atomicassets/build/API/Rpc/index.js"],"names":["__importDefault","mod","__esModule","Object","defineProperty","exports","value","Rpc_1","require","RpcError_1","Asset_1","Cache_1","Collection_1","Offer_1","Queue_1","Schema_1","Template_1","RpcApi","endpoint","contract","args","rateLimit","fetch","fetchBuiltin","global","queue","default","cache","action","_config","Promise","resolve","reject","getTableRows","code","scope","table","resp","rows","length","owner","id","deleteAsset","fetchAsset","data","undefined","collectionName","templateID","deleteTemplate","fetchTemplate","deleteCollection","fetchCollection","fetchCollectionTemplates","map","templateRow","String","template_id","fetchCollectionSchemas","schemaRow","schema_name","schemaName","deleteSchema","fetchSchema","offerID","deleteOffer","fetchOffer","account","fetchAccountOffers","offerRow","offer_id","fetchAccountAssets","assetRow","asset_id","preloadCollection","filter","collection_name","table_key","lower_bound","upper_bound","index_position","key_type","fetchRpc","limit","reverse","show_payer","json","path","body","f","JSON","stringify","method","response","isFetchError","processed","except","ok"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst Rpc_1 = __importDefault(require(\"../../Actions/Rpc\"));\nconst RpcError_1 = __importDefault(require(\"../../Errors/RpcError\"));\nconst Asset_1 = __importDefault(require(\"./Asset\"));\nconst Cache_1 = __importDefault(require(\"./Cache\"));\nconst Collection_1 = __importDefault(require(\"./Collection\"));\nconst Offer_1 = __importDefault(require(\"./Offer\"));\nconst Queue_1 = __importDefault(require(\"./Queue\"));\nconst Schema_1 = __importDefault(require(\"./Schema\"));\nconst Template_1 = __importDefault(require(\"./Template\"));\nclass RpcApi {\n    constructor(endpoint, contract, args = { rateLimit: 4 }) {\n        this.endpoint = endpoint;\n        this.contract = contract;\n        if (args.fetch) {\n            this.fetchBuiltin = args.fetch;\n        }\n        else {\n            this.fetchBuiltin = global.fetch;\n        }\n        this.queue = new Queue_1.default(this, args.rateLimit);\n        this.cache = new Cache_1.default();\n        this.action = new Rpc_1.default(this);\n        this._config = new Promise((async (resolve, reject) => {\n            try {\n                const resp = await this.getTableRows({\n                    code: this.contract, scope: this.contract, table: 'config'\n                });\n                if (resp.rows.length !== 1) {\n                    return reject('invalid config');\n                }\n                return resolve(resp.rows[0]);\n            }\n            catch (e) {\n                reject(e);\n            }\n        }));\n    }\n    async config() {\n        return await this._config;\n    }\n    async getAsset(owner, id, cache = true) {\n        if (!cache) {\n            this.cache.deleteAsset(id);\n        }\n        const data = await this.queue.fetchAsset(owner, id, cache);\n        return new Asset_1.default(this, owner, id, data, undefined, undefined, undefined, cache);\n    }\n    async getTemplate(collectionName, templateID, cache = true) {\n        if (!cache) {\n            this.cache.deleteTemplate(collectionName, templateID);\n        }\n        const data = await this.queue.fetchTemplate(collectionName, templateID, cache);\n        return new Template_1.default(this, collectionName, templateID, data, undefined, cache);\n    }\n    async getCollection(collectionName, cache = true) {\n        if (!cache) {\n            this.cache.deleteCollection(collectionName);\n        }\n        const data = await this.queue.fetchCollection(collectionName, cache);\n        return new Collection_1.default(this, collectionName, data, cache);\n    }\n    async getCollectionTemplates(collectionName) {\n        return (await this.queue.fetchCollectionTemplates(collectionName)).map((templateRow) => {\n            return new Template_1.default(this, collectionName, String(templateRow.template_id), templateRow, undefined);\n        });\n    }\n    async getCollectionsSchemas(collectionName) {\n        return (await this.queue.fetchCollectionSchemas(collectionName)).map((schemaRow) => {\n            return new Schema_1.default(this, collectionName, schemaRow.schema_name, undefined);\n        });\n    }\n    async getSchema(collectionName, schemaName, cache = true) {\n        if (!cache) {\n            this.cache.deleteSchema(collectionName, schemaName);\n        }\n        const data = await this.queue.fetchSchema(collectionName, schemaName, cache);\n        return new Schema_1.default(this, collectionName, schemaName, data, cache);\n    }\n    async getOffer(offerID, cache = true) {\n        if (!cache) {\n            this.cache.deleteOffer(offerID);\n        }\n        const data = await this.queue.fetchOffer(offerID, cache);\n        return new Offer_1.default(this, offerID, data, undefined, undefined, cache);\n    }\n    async getAccountOffers(account) {\n        return (await this.queue.fetchAccountOffers(account)).map((offerRow) => {\n            return new Offer_1.default(this, offerRow.offer_id, offerRow, undefined, undefined);\n        });\n    }\n    async getAccountAssets(account) {\n        return (await this.queue.fetchAccountAssets(account)).map((assetRow) => {\n            return new Asset_1.default(this, account, assetRow.asset_id, assetRow, undefined, undefined, undefined);\n        });\n    }\n    async getCollectionInventory(collectionName, account) {\n        await this.queue.preloadCollection(collectionName, true);\n        return (await this.queue.fetchAccountAssets(account))\n            .filter(assetRow => assetRow.collection_name === collectionName)\n            .map((assetRow) => {\n            return new Asset_1.default(this, account, assetRow.asset_id, assetRow, undefined, undefined, undefined);\n        });\n    }\n    async preloadCollection(collectionName, cache = true) {\n        await this.queue.preloadCollection(collectionName, cache);\n    }\n    async getTableRows({ code, scope, table, table_key = '', lower_bound = '', upper_bound = '', index_position = 1, key_type = '' }) {\n        return await this.fetchRpc('/v1/chain/get_table_rows', {\n            code, scope, table, table_key,\n            lower_bound, upper_bound, index_position,\n            key_type, limit: 101, reverse: false, show_payer: false, json: true\n        });\n    }\n    async fetchRpc(path, body) {\n        let response;\n        let json;\n        try {\n            const f = this.fetchBuiltin;\n            response = await f(this.endpoint + path, {\n                body: JSON.stringify(body),\n                method: 'POST'\n            });\n            json = await response.json();\n        }\n        catch (e) {\n            e.isFetchError = true;\n            throw e;\n        }\n        if ((json.processed && json.processed.except) || !response.ok) {\n            throw new RpcError_1.default(json);\n        }\n        return json;\n    }\n}\nexports.default = RpcApi;\n"]},"metadata":{},"sourceType":"script"}